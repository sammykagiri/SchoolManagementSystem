{% extends 'base.html' %}

{% block title %}Generate Generic Classes | School Management System{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-magic me-2"></i>Generate Generic Classes
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>How it works:</strong> Select grades and specify the number of streams per grade. 
                        The system will create classes for each grade with the specified number of streams (e.g., "Grade 1 A", "Grade 1 B", "Grade 2 A", etc.).
                    </div>
                    
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <label class="form-label fw-bold">Select Grades</label>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="all_grades" name="all_grades" 
                                           onchange="toggleGradeSelection()" {% if all_grades %}checked{% endif %}>
                                    <label class="form-check-label" for="all_grades">
                                        <strong>All Grades</strong>
                                    </label>
                                </div>
                            </div>
                            
                            <div id="gradeSelection" class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                                <div class="row g-2">
                                    {% for grade in grades %}
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input grade-checkbox" type="checkbox" 
                                                   name="selected_grades" value="{{ grade.id }}" id="grade_{{ grade.id }}"
                                                   onchange="updateAllGradesCheckbox()"
                                                   {% if selected_grades and grade.id|stringformat:'s' in selected_grades %}checked{% endif %}>
                                            <label class="form-check-label" for="grade_{{ grade.id }}">
                                                {{ grade.name }}
                                            </label>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="col-12">
                                        <p class="text-muted">No grades found. <a href="{% url 'core:grade_list' %}">Create grades first</a>.</p>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_num_streams" class="form-label">
                                Number of Streams per Grade <span class="text-danger">*</span>
                            </label>
                            <input type="number" 
                                   name="num_streams" 
                                   id="id_num_streams" 
                                   class="form-control" 
                                   min="1" 
                                   max="20" 
                                   placeholder="e.g., 3"
                                   value="{% if num_streams %}{{ num_streams }}{% endif %}"
                                   required>
                            <div class="form-text">Enter the number of streams/classes per grade (e.g., 3 will create 3 classes per grade)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_stream_names" class="form-label">
                                Stream Names (Optional)
                            </label>
                            <input type="text" 
                                   name="stream_names" 
                                   id="id_stream_names" 
                                   class="form-control" 
                                   placeholder="e.g., A, B, C or 1, 2, 3"
                                   value="{% if stream_names %}{{ stream_names }}{% endif %}">
                            <div class="form-text">
                                Comma-separated stream names (e.g., "A, B, C" or "1, 2, 3"). 
                                If left empty, default names will be used (A, B, C, ... for up to 26 streams, or 1, 2, 3, ... for more).
                            </div>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-magic me-2"></i>Generate Classes
                            </button>
                            <a href="{% url 'core:class_list' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-body">
                    <h6 class="card-title">Examples:</h6>
                    <ul class="mb-0">
                        <li><strong>Grades:</strong> All Grades, <strong>Streams:</strong> 3, <strong>Names:</strong> A, B, C → Creates: Grade 1 A, Grade 1 B, Grade 1 C, Grade 2 A, Grade 2 B, Grade 2 C, ...</li>
                        <li><strong>Grades:</strong> Grade 1, Grade 2, <strong>Streams:</strong> 2, <strong>Names:</strong> (empty) → Creates: Grade 1 A, Grade 1 B, Grade 2 A, Grade 2 B</li>
                        <li><strong>Grades:</strong> Grade 1, <strong>Streams:</strong> 4, <strong>Names:</strong> 1, 2, 3, 4 → Creates: Grade 1 1, Grade 1 2, Grade 1 3, Grade 1 4</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function toggleGradeSelection() {
        const allGradesCheckbox = document.getElementById('all_grades');
        const gradeCheckboxes = document.querySelectorAll('.grade-checkbox');
        
        if (allGradesCheckbox.checked) {
            // When "All Grades" is checked, check all individual grades but keep them enabled
            gradeCheckboxes.forEach(cb => {
                cb.checked = true;
                cb.disabled = false;
            });
        } else {
            // When "All Grades" is unchecked, keep individual selections but don't disable
            // Individual checkboxes remain enabled for manual selection
        }
    }
    
    function updateAllGradesCheckbox() {
        const allGradesCheckbox = document.getElementById('all_grades');
        const gradeCheckboxes = document.querySelectorAll('.grade-checkbox');
        const allChecked = Array.from(gradeCheckboxes).every(cb => cb.checked);
        const someChecked = Array.from(gradeCheckboxes).some(cb => cb.checked);
        
        // Update "All Grades" checkbox based on individual grade selections
        allGradesCheckbox.checked = allChecked && someChecked;
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        toggleGradeSelection();
        
        // Add event listeners to individual grade checkboxes
        const gradeCheckboxes = document.querySelectorAll('.grade-checkbox');
        gradeCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateAllGradesCheckbox);
        });
    });
</script>
{% endblock %}




